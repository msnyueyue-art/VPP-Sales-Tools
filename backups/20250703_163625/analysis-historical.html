<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>历史数据深度分析 - U Energy</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="components/common-styles.css">
    <link rel="stylesheet" href="components/i18n.css">
    <link rel="stylesheet" href="components/notification-center.css">
    <link rel="stylesheet" href="components/header-nav.css">
    <link rel="stylesheet" href="components/standard-layout.css">
    <script src="components/i18n.js"></script>
    <script src="components/simple-message-icon.js"></script>
    <script src="components/header-nav.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000 !important;
        }

        .container {
            max-width: 95%;
            margin: 0 auto;
            padding: 120px 10px 24px;
            min-height: calc(100vh - 200px);
        }

        /* Page Header */
        .page-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 36px;
            font-weight: 200;
            color: var(--color-text);
            margin: 0;
            letter-spacing: -1px;
        }

        .analysis-toggle {
            display: inline-flex;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .toggle-btn {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.8);
        }

        .toggle-btn.active {
            background: var(--color-primary);
            color: #000;
            border-color: var(--color-primary);
            box-shadow: 0 0 12px rgba(0, 255, 136, 0.3);
        }

        .toggle-btn.active::after {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: 8px;
            padding: 1px;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.5;
        }

        /* Analysis Dimension Tabs */
        .dimension-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 16px;
        }

        .dimension-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .dimension-tab:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }

        .dimension-tab.active {
            background: linear-gradient(135deg, rgba(0,185,107,0.1), rgba(30,127,255,0.1));
            border-color: var(--color-primary);
        }

        .dimension-tab.active::after {
            content: '';
            position: absolute;
            bottom: -17px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 3px;
            background: var(--color-primary);
            border-radius: 2px;
        }

        .dimension-icon {
            font-size: 20px;
        }

        .dimension-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text);
        }

        /* Content Section */
        .dimension-content {
            display: none;
        }

        .dimension-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Analysis Cards */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        /* Large Summary Card */
        .summary-card {
            background: var(--color-bg-card);
            border-radius: var(--radius);
            border: 1.5px solid var(--color-border);
            padding: 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }
        
        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
        }
        
        .summary-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
        }
        
        .summary-card-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-text);
            letter-spacing: -0.5px;
        }
        
        .summary-card-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--color-primary);
            letter-spacing: -1px;
        }
        
        .summary-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
        }
        
        .summary-metric {
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s ease;
        }
        
        .summary-metric:hover {
            background: rgba(255,255,255,0.05);
            transform: translateY(-2px);
            border-color: rgba(255,255,255,0.15);
        }
        
        .summary-metric-label {
            font-size: 13px;
            color: var(--color-text-secondary);
            margin-bottom: 6px;
        }
        
        .summary-metric-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 2px;
        }
        
        .summary-metric-subtitle {
            font-size: 11px;
            color: var(--color-text-secondary);
        }
        
        .summary-metric-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 6px;
            font-size: 12px;
        }
        
        .summary-metric-trend.positive {
            color: var(--color-primary);
        }
        
        .summary-metric-trend.negative {
            color: #ff3b30;
        }
        
        .summary-metric-trend.warning {
            color: #ff9500;
        }
        
        .summary-metric.positive .summary-metric-value {
            color: var(--color-primary);
        }
        
        .summary-metric.negative .summary-metric-value {
            color: #ff3b30;
        }
        
        .summary-metric.warning .summary-metric-value {
            color: #ff9500;
        }
        
        /* Custom scrollbar for insight content */
        .insight-content::-webkit-scrollbar {
            width: 6px;
        }

        .insight-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .insight-content::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 136, 0.3);
            border-radius: 3px;
        }

        .insight-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 136, 0.5);
        }

        @media (max-width: 1200px) {
            .summary-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .summary-card-header {
                flex-direction: column;
                gap: 16px;
            }
            
            .summary-card-value {
                font-size: 36px;
            }
            
            .summary-metrics {
                grid-template-columns: 1fr;
            }
        }

        .analysis-card {
            background: var(--color-bg-card);
            border-radius: var(--radius);
            border: 1.5px solid var(--color-border);
            padding: 24px;
            transition: all 0.3s ease;
        }

        .analysis-card:hover {
            border-color: var(--color-primary);
            box-shadow: 0 4px 16px rgba(0, 185, 107, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
        }

        .card-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .card-subtitle {
            font-size: 13px;
            color: var(--color-text-secondary);
            margin-bottom: 16px;
        }

        .card-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .trend-positive {
            color: var(--color-primary);
        }

        .trend-negative {
            color: #ff3b30;
        }

        .trend-neutral {
            color: rgba(255,255,255,0.7);
        }

        /* Chart Container */
        .chart-container {
            background: var(--color-bg-card);
            border-radius: var(--radius);
            border: 1.5px solid var(--color-border);
            padding: 24px;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 20px;
        }

        .chart-box {
            width: 100%;
            height: 400px;
        }

        /* Risk Matrix */
        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .risk-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .risk-item:hover {
            background: rgba(255,255,255,0.05);
            transform: scale(1.02);
        }

        .risk-level {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
        }

        .risk-level.low {
            background: rgba(0,185,107,0.2);
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .risk-level.medium {
            background: rgba(255,149,0,0.2);
            color: #ff9500;
            border: 2px solid #ff9500;
        }

        .risk-level.high {
            background: rgba(255,59,48,0.2);
            color: #ff3b30;
            border: 2px solid #ff3b30;
        }

        .risk-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .risk-desc {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        /* Insight Box */
        .insight-box {
            background: linear-gradient(135deg, rgba(0,185,107,0.05), rgba(30,127,255,0.05));
            border: 2px solid rgba(0,185,107,0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .insight-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-content {
            font-size: 14px;
            line-height: 1.8;
            color: var(--color-text);
        }

        /* Recommendation Cards */
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .recommendation-card {
            background: rgba(30,127,255,0.05);
            border: 1.5px solid rgba(30,127,255,0.2);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            background: rgba(30,127,255,0.08);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(30,127,255,0.2);
        }

        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .recommendation-icon {
            width: 48px;
            height: 48px;
            background: rgba(30,127,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .recommendation-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .recommendation-impact {
            font-size: 12px;
            color: var(--color-accent);
        }

        .recommendation-desc {
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .recommendation-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(30,127,255,0.2);
            border: 1px solid rgba(30,127,255,0.3);
            border-radius: 8px;
            color: var(--color-accent);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recommendation-action:hover {
            background: rgba(30,127,255,0.3);
            transform: translateX(4px);
        }

        /* Time Dimension Selector */
        .time-dimension-container {
            margin-bottom: 24px;
            padding: 20px 24px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .time-dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-dimension-label {
            font-size: 16px;
            font-weight: 500;
            color: var(--color-text);
        }

        .time-dimension-tabs {
            display: flex;
            gap: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 4px;
        }

        .time-dimension-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .time-dimension-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .time-dimension-btn:hover {
            background: rgba(255,255,255,0.08);
            color: var(--color-text);
            transform: translateY(-1px);
        }

        .time-dimension-btn:hover::before {
            left: 100%;
        }

        .time-dimension-btn.active {
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            color: #fff;
            box-shadow: 0 4px 12px rgba(0,185,107,0.3);
        }

        .time-dimension-btn.active::before {
            display: none;
        }

        /* Time Range Selector (for individual charts) */
        .time-range-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 4px;
        }

        .time-range-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-range-btn:hover {
            background: rgba(255,255,255,0.08);
            color: var(--color-text);
        }

        .time-range-btn.active {
            background: var(--color-primary);
            color: #fff;
        }

        /* Comparative Analysis */
        .comparison-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .comparison-card {
            background: var(--color-bg-card);
            border-radius: var(--radius);
            border: 1.5px solid var(--color-border);
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .comparison-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .comparison-card.better::before {
            background: var(--color-primary);
        }

        .comparison-card.worse::before {
            background: #ff3b30;
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .comparison-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
        }

        .comparison-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .comparison-badge.better {
            background: rgba(0,185,107,0.2);
            color: var(--color-primary);
        }

        .comparison-badge.worse {
            background: rgba(255,59,48,0.2);
            color: #ff3b30;
        }

        .comparison-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-label {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        .metric-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
        }

        /* Advanced Filter Panel */
        .filter-panel {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: none;
        }

        .filter-panel.active {
            display: block;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .filter-select {
            padding: 8px 12px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--color-text);
            font-size: 14px;
            cursor: pointer;
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 1px solid rgba(255,255,255,0.2);
            background: transparent;
            color: var(--color-text);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.3);
        }

        .filter-btn.primary {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: #fff;
        }

        .filter-btn.primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
        }

        /* Export Options */
        .export-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 8px;
            min-width: 200px;
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
        }

        .export-menu.active {
            display: block;
        }

        .export-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-option:hover {
            background: rgba(255,255,255,0.1);
        }

        .export-icon {
            font-size: 18px;
        }

        .export-text {
            font-size: 14px;
            color: var(--color-text);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dimension-tabs {
                flex-wrap: wrap;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }

            .comparison-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 100px 10px 24px;
            }

            .page-header {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }

            .page-title {
                font-size: 28px;
            }

            .recommendation-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header Container -->
    <div id="headerContainer"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">虚拟电厂深度分析</h1>
            <div class="analysis-toggle">
                <button class="toggle-btn" onclick="switchAnalysisMode('realtime', this)">实时分析</button>
                <button class="toggle-btn active" onclick="switchAnalysisMode('historical', this)">历史分析</button>
            </div>
        </div>

        <!-- Time Dimension Selector (only show when historical is selected) -->
        <div class="time-dimension-container" id="timeDimensionContainer">
            <div class="time-dimension-header">
                <span class="time-dimension-label">时间维度</span>
                <div class="time-dimension-tabs">
                    <button class="time-dimension-btn active" data-range="24h" onclick="switchTimeDimension('24h', this)">近24小时</button>
                    <button class="time-dimension-btn" data-range="7d" onclick="switchTimeDimension('7d', this)">近7天</button>
                    <button class="time-dimension-btn" data-range="30d" onclick="switchTimeDimension('30d', this)">近30天</button>
                </div>
            </div>
        </div>

        <!-- Dimension Tabs -->
        <div class="dimension-tabs">
            <div class="dimension-tab active" onclick="switchDimension('price-forecast', this)">
                <span class="dimension-icon">📈</span>
                <span class="dimension-name">价格预测</span>
            </div>
            <div class="dimension-tab" onclick="switchDimension('operation-analysis', this)">
                <span class="dimension-icon">⚙️</span>
                <span class="dimension-name">操作分析</span>
            </div>
            <div class="dimension-tab" onclick="switchDimension('profit-analysis', this)">
                <span class="dimension-icon">💰</span>
                <span class="dimension-name">获利分析</span>
            </div>
            <div class="dimension-tab" onclick="switchDimension('user-analysis', this)">
                <span class="dimension-icon">👤</span>
                <span class="dimension-name">用户分析</span>
            </div>
        </div>

        <!-- Price Forecast Content -->
        <div class="dimension-content active" id="price-forecast">
            <!-- Top Section: Half-Half Layout -->
            <div style="display: flex; gap: 24px; margin-bottom: 24px;">
                <!-- Left Half: Summary Card -->
                <div class="summary-card" style="flex: 1; margin: 0; padding: 16px; height: 340px;">
                    <div class="summary-card-header" style="margin-bottom: 12px;">
                        <h2 class="summary-card-title" style="font-size: 18px;">价格预测准确性</h2>
                        <div class="summary-card-value" style="font-size: 32px;">94.7%</div>
                    </div>
                    <div class="summary-metrics" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="summary-metric positive">
                            <div class="summary-metric-label">准确预测</div>
                            <div class="summary-metric-value">6,794</div>
                            <div class="summary-metric-subtitle">共7,176次预测中</div>
                            <div class="summary-metric-trend positive">
                                <span>✓</span>
                                <span>准确预测占比94.7%</span>
                            </div>
                        </div>
                        <div class="summary-metric">
                            <div class="summary-metric-label">轻微偏差</div>
                            <div class="summary-metric-value">287</div>
                            <div class="summary-metric-subtitle">偏差≤5% (4.0%)</div>
                            <div class="summary-metric-trend positive">
                                <span>~</span>
                                <span>可接受范围</span>
                            </div>
                        </div>
                        <div class="summary-metric negative">
                            <div class="summary-metric-label">重大偏差</div>
                            <div class="summary-metric-value">95</div>
                            <div class="summary-metric-subtitle">偏差>5% (1.3%)</div>
                            <div class="summary-metric-trend negative">
                                <span>!</span>
                                <span>需要关注</span>
                            </div>
                        </div>
                        <div class="summary-metric warning">
                            <div class="summary-metric-label">平均偏差</div>
                            <div class="summary-metric-value">$8.4/MWh</div>
                            <div class="summary-metric-subtitle">绝对价格偏差</div>
                            <div class="summary-metric-trend positive">
                                <span>▼</span>
                                <span>平均偏差率为1.9%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Half: Analysis Conclusion -->
                <div class="insight-box" style="flex: 1; margin: 0; height: 350px; display: flex; flex-direction: column;">
                    <div class="insight-title" style="flex-shrink: 0;">
                        <span>🎯</span>
                        <span>分析结论</span>
                    </div>
                    <div class="insight-content" style="flex: 1; overflow-y: auto; overflow-x: hidden; padding-right: 10px; color: #fff;">
                        <strong style="font-size: 16px; color: #fff;">✨ 优秀表现</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>整体出色：</strong>我们的价格预测模型非常准，准确率高达<span style="color: #00ff88; font-weight: 600;">94.7%</span>，平均偏差只有<span style="color: #00ff88; font-weight: 600;">1.9%</span>。</li>
                            <li><strong>趋势精准：</strong>趋势预测准确率达到了<span style="color: #00ff88; font-weight: 600;">96.8%</span>，能精准判断价格是涨还是跌。</li>
                            <li><strong>谷值预测准：</strong>谷值预测准确率为<span style="color: #00ff88; font-weight: 600;">95.2%</span>，比峰值预测准确率（93.5%）还高。</li>
                            <li><strong>高准确率时段：</strong>凌晨2:00-6:00和下午14:00-18:00的预测准确率超过<span style="color: #00ff88; font-weight: 600;">95%</span>。</li>
                        </ul>
                        
                        <strong style="font-size: 16px; color: #fff;">⚠️ 需要改进</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>峰价时段和中期预测：</strong>价格超过$300/MWh的峰价时段准确率为<span style="color: #ff9500;">91.2%</span>，比整体水平低3.5%；12小时中期预测准确率仅<span style="color: #ff9500;">89.3%</span>。</li>
                            <li><strong>低准确率时段：</strong>晚间19:00-21:00的预测准确率是<span style="color: #ff9500;">85%</span>，需求波动较大，建议该时段谨慎交易。</li>
                        </ul>
                        
                        <strong style="font-size: 16px; color: #fff;">🔍 重点分析</strong>
                        <div style="margin: 10px 0;">
                            <strong>偏差最大时段：</strong>12月15日19:00-21:00，预测价格$165/MWh，实际价格$195/MWh，偏差率为<span style="color: #ff3b30;">15.4%</span>。
                        </div>
                        
                        <strong>原因：</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>需求大增：</strong>该时段用电需求比预测增加了18%，主要是因为极端高温导致空调用电激增。</li>
                            <li><strong>发电减少：</strong>发电量比预测减少了12%，两个主要燃煤电厂临时检修，同时风电因高温无风发电量锐减。</li>
                            <li><strong>市场因素：</strong>邻近地区电力短缺，跨区域电力输送达到上限，导致本地价格急剧上涨。</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Additional Metrics Grid -->
            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">价格趋势准确率</span>
                    </div>
                    <div class="card-value">96.8%</div>
                    <div class="card-subtitle">正确识别涨跌趋势</div>
                    <div class="card-trend trend-positive">
                        <span>▲</span>
                        <span>趋势判断精准</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">峰值价格预测准确率</span>
                    </div>
                    <div class="card-value">91.2%</div>
                    <div class="card-subtitle">价格>$300/MWh时段</div>
                    <div class="card-trend trend-negative">
                        <span>▼</span>
                        <span>较整体低3.5%</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">谷值价格预测准确率</span>
                    </div>
                    <div class="card-value">97.8%</div>
                    <div class="card-subtitle">价格<$50/MWh时段</div>
                    <div class="card-trend trend-positive">
                        <span>▲</span>
                        <span>较整体高3.1%</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">中期预测准确性</span>
                    </div>
                    <div class="card-value">89.3%</div>
                    <div class="card-subtitle">$50/MWh&lt;价格&lt;$300/MWh时段</div>
                    <div class="card-trend trend-negative">
                        <span>▼</span>
                        <span>较整体低5.4%</span>
                    </div>
                </div>
            </div>

            <!-- Price Comparison Chart -->
            <div class="chart-container">
                <div class="chart-title">价格对比</div>
                <div id="priceComparisonChart" class="chart-box"></div>
            </div>

            <!-- Prediction Deviation Heatmap -->
            <div class="chart-container">
                <div class="chart-title">预测偏差率</div>
                <div id="predictionDeviationHeatmap" class="chart-box"></div>
            </div>

            <!-- Supply Demand Gap Analysis -->
            <div class="chart-container">
                <div class="chart-title">供需缺口分析</div>
                <div id="supplyDemandGapChart" class="chart-box"></div>
            </div>

        </div>

        

        

        

        

        

        

        <!-- Operation Analysis Content -->
        <div class="dimension-content" id="operation-analysis">
            <div class="analysis-grid">
                <div class="analysis-card excellent">
                    <div class="card-header">
                        <span class="card-title">🎯 卖在最佳点</span>
                    </div>
                    <div class="card-value">142次</div>
                    <div class="card-subtitle">完美时机</div>
                    <div class="card-trend trend-positive">
                        <span>✨</span>
                        <span>37.1%</span>
                    </div>
                </div>
                
                <div class="analysis-card good">
                    <div class="card-header">
                        <span class="card-title">👍 卖的不错</span>
                    </div>
                    <div class="card-value">156次</div>
                    <div class="card-subtitle">良好收益</div>
                    <div class="card-trend trend-positive">
                        <span>✓</span>
                        <span>40.7%</span>
                    </div>
                </div>
                
                <div class="analysis-card average">
                    <div class="card-header">
                        <span class="card-title">😐 一般</span>
                    </div>
                    <div class="card-value">59次</div>
                    <div class="card-subtitle">可以改进</div>
                    <div class="card-trend trend-warning">
                        <span>~</span>
                        <span>15.4%</span>
                    </div>
                </div>
                
                <div class="analysis-card poor">
                    <div class="card-header">
                        <span class="card-title">❌ 卖错了</span>
                    </div>
                    <div class="card-value">26次</div>
                    <div class="card-subtitle">需要优化</div>
                    <div class="card-trend trend-negative">
                        <span>⚠</span>
                        <span>6.8%</span>
                    </div>
                </div>
            </div>
            
            <!-- Selling Points Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <span class="chart-title">售电时机分析图表</span>
                    <div class="chart-controls">
                        <button class="chart-control-btn active" onclick="initializeSellingPointsChart('24h')">24小时</button>
                        <button class="chart-control-btn" onclick="initializeSellingPointsChart('7d')">7天</button>
                        <button class="chart-control-btn" onclick="initializeSellingPointsChart('30d')">30天</button>
                    </div>
                </div>
                <div id="sellingPointsChart" style="width: 100%; height: 400px;"></div>
            </div>
        </div>

        <!-- Profit Analysis Content -->
        <div class="dimension-content" id="profit-analysis">
            <div style="display: flex; gap: 24px; margin-bottom: 24px;">
                <!-- Left Half: Profit Statistics -->
                <div class="summary-card" style="flex: 1; margin: 0; padding: 16px; height: 340px;">
                    <div class="summary-card-header" style="margin-bottom: 12px;">
                        <h2 class="summary-card-title" style="font-size: 18px;">获利分析</h2>
                        <div class="summary-card-value" style="font-size: 32px;">$156.8K</div>
                    </div>
                    <div class="summary-metrics" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="summary-metric positive">
                            <div class="summary-metric-label">日均收益</div>
                            <div class="summary-metric-value">$5,227</div>
                            <div class="summary-metric-subtitle">过去30天平均</div>
                            <div class="summary-metric-trend positive">
                                <span>▲</span>
                                <span>增长15.3%</span>
                            </div>
                        </div>
                        <div class="summary-metric">
                            <div class="summary-metric-label">最高日收益</div>
                            <div class="summary-metric-value">$12,850</div>
                            <div class="summary-metric-subtitle">12月15日</div>
                            <div class="summary-metric-trend positive">
                                <span>★</span>
                                <span>历史新高</span>
                            </div>
                        </div>
                        <div class="summary-metric">
                            <div class="summary-metric-label">收益率</div>
                            <div class="summary-metric-value">18.6%</div>
                            <div class="summary-metric-subtitle">年化收益率</div>
                            <div class="summary-metric-trend positive">
                                <span>◆</span>
                                <span>超越目标</span>
                            </div>
                        </div>
                        <div class="summary-metric warning">
                            <div class="summary-metric-label">收益波动</div>
                            <div class="summary-metric-value">±28.5%</div>
                            <div class="summary-metric-subtitle">标准差</div>
                            <div class="summary-metric-trend warning">
                                <span>⚠</span>
                                <span>波动较大</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Half: Profit Analysis Conclusion -->
                <div class="insight-box" style="flex: 1; margin: 0; height: 350px; display: flex; flex-direction: column;">
                    <div class="insight-title" style="flex-shrink: 0;">
                        <span>💰</span>
                        <span>获利分析结论</span>
                    </div>
                    <div class="insight-content" style="flex: 1; overflow-y: auto; overflow-x: hidden; padding-right: 10px; color: #fff;">
                        <strong style="font-size: 16px; color: #fff;">📊 收益构成</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>能量套利：</strong>占总收益<span style="color: #00ff88; font-weight: 600;">78.5%</span>，主要来自日内价格波动套利。</li>
                            <li><strong>容量服务：</strong>占总收益<span style="color: #00ff88; font-weight: 600;">15.2%</span>，提供电网稳定性服务。</li>
                            <li><strong>辅助服务：</strong>占总收益<span style="color: #00ff88; font-weight: 600;">6.3%</span>，包括频率调节等。</li>
                        </ul>
                        
                        <strong style="font-size: 16px; color: #fff;">💡 盈利模式分析</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>高峰时段：</strong>17:00-21:00贡献了<span style="color: #00ff88;">45%</span>的日收益。</li>
                            <li><strong>价差利用：</strong>平均买卖价差达<span style="color: #00ff88;">$85/MWh</span>，有效利用价格波动。</li>
                            <li><strong>循环效率：</strong>日均完成<span style="color: #00ff88;">2.3个</span>充放电循环。</li>
                        </ul>
                        
                        <strong style="font-size: 16px; color: #fff;">⚠️ 风险提示</strong>
                        <div style="margin: 10px 0;">
                            收益波动率达28.5%，建议建立风险对冲机制。极端天气日收益可能为负值。
                        </div>
                        
                        <strong>优化潜力：</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>优化充放电策略可提升收益10-15%</li>
                            <li>参与更多辅助服务市场增加稳定收入</li>
                            <li>动态调整容量分配提高资产利用率</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Profit Metrics Grid -->
            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">投资回报率</span>
                    </div>
                    <div class="card-value">8.7%</div>
                    <div class="card-subtitle">月度ROI</div>
                    <div class="card-trend trend-positive">
                        <span>▲</span>
                        <span>超预期2.1%</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">成本收益比</span>
                    </div>
                    <div class="card-value">1:8.7</div>
                    <div class="card-subtitle">每$1成本产生收益</div>
                    <div class="card-trend trend-positive">
                        <span>◆</span>
                        <span>效率优秀</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">盈亏平衡点</span>
                    </div>
                    <div class="card-value">$45/MWh</div>
                    <div class="card-subtitle">最低价差要求</div>
                    <div class="card-trend trend-positive">
                        <span>✓</span>
                        <span>安全边际高</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">资金回收期</span>
                    </div>
                    <div class="card-value">4.2年</div>
                    <div class="card-subtitle">按当前收益计算</div>
                    <div class="card-trend trend-positive">
                        <span>▼</span>
                        <span>缩短0.8年</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Analysis Content -->
        <div class="dimension-content" id="user-analysis">
            <div style="display: flex; gap: 24px; margin-bottom: 24px;">
                <!-- Left Half: User Cooperation Stats -->
                <div class="summary-card" style="flex: 1; margin: 0; padding: 16px; height: 340px;">
                    <div class="summary-card-header" style="margin-bottom: 12px;">
                        <h2 class="summary-card-title" style="font-size: 18px;">用户配合度统计</h2>
                        <div class="summary-card-value" style="font-size: 32px;">78.5%</div>
                    </div>
                    <div class="summary-metrics" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="summary-metric positive">
                            <div class="summary-metric-label">🟢 积极响应</div>
                            <div class="summary-metric-value">785</div>
                            <div class="summary-metric-subtitle">用户数 (78.5%)</div>
                            <div class="summary-metric-trend positive">
                                <span>⚡</span>
                                <span>立即执行</span>
                            </div>
                        </div>
                        <div class="summary-metric">
                            <div class="summary-metric-label">🟡 延迟响应</div>
                            <div class="summary-metric-value">138</div>
                            <div class="summary-metric-subtitle">用户数 (13.8%)</div>
                            <div class="summary-metric-trend">
                                <span>⏱</span>
                                <span>5-15分钟内</span>
                            </div>
                        </div>
                        <div class="summary-metric negative">
                            <div class="summary-metric-label">🟠 部分配合</div>
                            <div class="summary-metric-value">52</div>
                            <div class="summary-metric-subtitle">用户数 (5.2%)</div>
                            <div class="summary-metric-trend">
                                <span>◐</span>
                                <span>部分执行</span>
                            </div>
                        </div>
                        <div class="summary-metric negative">
                            <div class="summary-metric-label">🔴 无响应</div>
                            <div class="summary-metric-value">25</div>
                            <div class="summary-metric-subtitle">用户数 (2.5%)</div>
                            <div class="summary-metric-trend negative">
                                <span>✗</span>
                                <span>需要关注</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Half: User Cooperation Analysis -->
                <div class="insight-box" style="flex: 1; margin: 0; height: 350px; display: flex; flex-direction: column;">
                    <div class="insight-title" style="flex-shrink: 0;">
                        <span>🤝</span>
                        <span>用户配合分析</span>
                    </div>
                    <div class="insight-content" style="flex: 1; overflow-y: auto; overflow-x: hidden; padding-right: 10px; color: #fff;">
                        <strong style="font-size: 16px; color: #fff;">✅ 配合度较高</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>总体配合率：</strong><span style="color: #00ff88; font-weight: 600;">92.3%</span>的用户能按建议操作</li>
                            <li><strong>即时响应：</strong><span style="color: #00ff88; font-weight: 600;">78.5%</span>用户立即执行建议</li>
                            <li><strong>响应时间：</strong>平均<span style="color: #00ff88; font-weight: 600;">2.3分钟</span>内响应</li>
                        </ul>
                        
                        <strong style="font-size: 16px; color: #fff;">⚠️ 需要改进</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>延迟执行：</strong>13.8%用户响应较慢，影响收益优化</li>
                            <li><strong>部分配合：</strong>5.2%用户只执行部分建议</li>
                            <li><strong>无响应用户：</strong>2.5%用户需要重点关注</li>
                        </ul>
                        
                        <strong style="font-size: 16px; color: #fff;">📈 改进建议</strong>
                        <div style="margin: 10px 0;">
                            <strong>关键措施：</strong>建立用户激励机制，对高配合度用户给予优先服务，
                            对低配合度用户提供<span style="color: #00ff88;">个性化培训</span>。
                        </div>
                        
                        <strong>具体行动：</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>设置响应速度排行榜和奖励机制</li>
                            <li>为延迟用户推送简化操作指引</li>
                            <li>定期回访无响应用户了解原因</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- User Cooperation Metrics Grid -->
            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">总用户数</span>
                    </div>
                    <div class="card-value">1,000</div>
                    <div class="card-subtitle">活跃用户</div>
                    <div class="card-trend trend-positive">
                        <span>👥</span>
                        <span>基础规模</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">平均响应时间</span>
                    </div>
                    <div class="card-value">2.3分钟</div>
                    <div class="card-subtitle">系统建议响应</div>
                    <div class="card-trend trend-positive">
                        <span>⚡</span>
                        <span>响应迅速</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">完成率</span>
                    </div>
                    <div class="card-value">98.7%</div>
                    <div class="card-subtitle">建议执行完成率</div>
                    <div class="card-trend trend-positive">
                        <span>✓</span>
                        <span>执行优秀</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-title">问题用户</span>
                    </div>
                    <div class="card-value">25</div>
                    <div class="card-subtitle">需要关注用户数</div>
                    <div class="card-trend trend-neutral">
                        <span>⚠️</span>
                        <span>重点关注</span>
                    </div>
                </div>
            </div>
            
            <!-- User Cooperation Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <span class="chart-title">24小时用户配合度趋势</span>
                    <div class="chart-controls">
                        <button class="chart-control-btn active" onclick="initializeUserCooperationChart('24h')">24小时</button>
                        <button class="chart-control-btn" onclick="initializeUserCooperationChart('7d')">7天</button>
                        <button class="chart-control-btn" onclick="initializeUserCooperationChart('30d')">30天</button>
                    </div>
                </div>
                <div id="userCooperationChart" style="width: 100%; height: 400px;"></div>
            </div>
        </div>
    </div>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize HeaderNav
            new HeaderNav({
                currentPage: 'analysis-historical',
                showMessageCenter: true,
                showUserAvatar: true,
                showLanguageSelector: true
            });

            // Initialize charts based on current dimension
            initializeCharts();
            
            // Initialize selling performance metrics with default time dimension
            updateSellingPerformanceMetrics('24h');
            
        });

        // Global variables
        let currentTimeDimension = '24h';
        let currentDimension = 'price-forecast';

        // Switch between historical and realtime analysis
        function switchAnalysisMode(mode, button) {
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');

            const timeDimensionContainer = document.getElementById('timeDimensionContainer');
            
            if (mode === 'historical') {
                timeDimensionContainer.style.display = 'block';
            } else if (mode === 'realtime') {
                timeDimensionContainer.style.display = 'none';
                // Redirect to today analysis page
                window.location.href = 'analysis-today.html';
            }
        }

        // Switch time dimension
        function switchTimeDimension(range, button) {
            // Update active button
            document.querySelectorAll('.time-dimension-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');

            currentTimeDimension = range;
            
            // Update all data based on new time dimension
            updateAllAnalysisData(range);
            
            // Show loading indicator
            showLoadingIndicator();
            
            // Simulate data loading delay
            setTimeout(() => {
                hideLoadingIndicator();
                updateDashboardMetrics(range);
                updateOperationMetrics(range);
                updateAllCharts(range);
                updateInsightContent(range);
            }, 500);
        }

        // Update operation analysis metrics based on time dimension
        function updateOperationMetrics(range) {
            const metricsData = {
                '24h': {
                    bestTimeTitle: '时机把握评级',
                    bestTimeValue: 'A级',
                    bestTimeSubtitle: '昨天3次都在高价时卖出',
                    bestTimeTrend: '时机精准',
                    earningsTitle: '卖出时机分析',
                    earningsValue: '17:45最佳',
                    earningsSubtitle: '在晚高峰$450时卖出',
                    earningsTrend: '抓住最高点',
                    missedTitle: '早卖晚卖分析',
                    missedValue: '1次偏早',
                    missedSubtitle: '提前20分钟，少赚$180',
                    missedTrend: '可以更耐心',
                    suggestionTitle: '改进建议',
                    suggestionValue: '关注17:30',
                    suggestionSubtitle: '晚高峰通常更高',
                    suggestionTrend: '延后观察'
                },
                '7d': {
                    bestTimeTitle: '时机把握评级',
                    bestTimeValue: 'B+级',
                    bestTimeSubtitle: '12次中8次在合适时机',
                    bestTimeTrend: '逐步改善',
                    earningsTitle: '卖出时机分析',
                    earningsValue: '高峰命中率67%',
                    earningsSubtitle: '抓住8个高峰，错过4个',
                    earningsTrend: '主要错过早高峰',
                    missedTitle: '早卖晚卖分析',
                    missedValue: '习惯早卖30分钟',
                    missedSubtitle: '保守操作，少赚$1,200',
                    missedTrend: '偏向保守',
                    suggestionTitle: '改进建议',
                    suggestionValue: '重视7:30和17:30',
                    suggestionSubtitle: '双高峰都要关注',
                    suggestionTrend: '提升耐心'
                },
                '30d': {
                    bestTimeTitle: '时机把握评级',
                    bestTimeValue: 'B级',
                    bestTimeSubtitle: '58次中43次在合适时机',
                    bestTimeTrend: '稳定发挥',
                    earningsTitle: '卖出时机分析',
                    earningsValue: '高峰命中率74%',
                    earningsSubtitle: '整体表现平稳',
                    earningsTrend: '需要突破',
                    missedTitle: '早卖晚卖分析',
                    missedValue: '从早卖2小时到30分钟',
                    missedSubtitle: '耐心程度明显提升',
                    missedTrend: '学习效果好',
                    suggestionTitle: '改进建议',
                    suggestionValue: '目标：命中率85%',
                    suggestionSubtitle: '专注工作日17:30',
                    suggestionTrend: '继续优化'
                }
            };

            const data = metricsData[range] || metricsData['24h'];
            
            // Update best time metric
            if (document.getElementById('bestTimeTitle')) {
                document.getElementById('bestTimeTitle').textContent = data.bestTimeTitle;
                document.getElementById('bestTimeValue').textContent = data.bestTimeValue;
                document.getElementById('bestTimeSubtitle').textContent = data.bestTimeSubtitle;
                document.getElementById('bestTimeTrend').textContent = data.bestTimeTrend;
            }
            
            // Update earnings metric
            if (document.getElementById('earningsTitle')) {
                document.getElementById('earningsTitle').textContent = data.earningsTitle;
                document.getElementById('earningsValue').textContent = data.earningsValue;
                document.getElementById('earningsSubtitle').textContent = data.earningsSubtitle;
                document.getElementById('earningsTrend').textContent = data.earningsTrend;
            }
            
            // Update missed opportunities metric
            if (document.getElementById('missedTitle')) {
                document.getElementById('missedTitle').textContent = data.missedTitle;
                document.getElementById('missedValue').textContent = data.missedValue;
                document.getElementById('missedSubtitle').textContent = data.missedSubtitle;
                document.getElementById('missedTrend').textContent = data.missedTrend;
            }
            
            // Update suggestions metric
            if (document.getElementById('suggestionTitle')) {
                document.getElementById('suggestionTitle').textContent = data.suggestionTitle;
                document.getElementById('suggestionValue').textContent = data.suggestionValue;
                document.getElementById('suggestionSubtitle').textContent = data.suggestionSubtitle;
                document.getElementById('suggestionTrend').textContent = data.suggestionTrend;
            }
            
            // Update selling performance metrics
            updateSellingPerformanceMetrics(range);
        }

        // Update selling performance metrics based on time dimension
        function updateSellingPerformanceMetrics(range) {
            const sellingMetricsData = {
                '24h': {
                    total: { value: '3次', subtitle: '昨天总交易次数', trend: '' },
                    good: { value: '2次', subtitle: '占比67%', trend: '' },
                    average: { value: '1次', subtitle: '1次卖早，0次卖晚', trend: '' },
                    poor: { value: '0次', subtitle: '0次卖早，0次卖晚', trend: '' }
                },
                '7d': {
                    total: { value: '12次', subtitle: '近7天总交易次数', trend: '' },
                    good: { value: '8次', subtitle: '占比67%', trend: '' },
                    average: { value: '3次', subtitle: '2次卖早，1次卖晚', trend: '' },
                    poor: { value: '1次', subtitle: '1次卖早，0次卖晚', trend: '' }
                },
                '30d': {
                    total: { value: '58次', subtitle: '近30天总交易次数', trend: '' },
                    good: { value: '43次', subtitle: '占比74%', trend: '' },
                    average: { value: '12次', subtitle: '7次卖早，5次卖晚', trend: '' },
                    poor: { value: '3次', subtitle: '2次卖早，1次卖晚', trend: '' }
                }
            };

            const data = sellingMetricsData[range] || sellingMetricsData['24h'];
            
            // Update total sellings
            if (document.getElementById('totalSellingsValue')) {
                document.getElementById('totalSellingsValue').textContent = data.total.value;
                document.getElementById('totalSellingsSubtitle').textContent = data.total.subtitle;
            }
            
            // Update good sellings
            if (document.getElementById('goodSellingsValue')) {
                document.getElementById('goodSellingsValue').textContent = data.good.value;
                document.getElementById('goodSellingsSubtitle').textContent = data.good.subtitle;
            }
            
            // Update average sellings
            if (document.getElementById('averageSellingsValue')) {
                document.getElementById('averageSellingsValue').textContent = data.average.value;
                document.getElementById('averageSellingsSubtitle').textContent = data.average.subtitle;
            }
            
            // Update poor sellings
            if (document.getElementById('poorSellingsValue')) {
                document.getElementById('poorSellingsValue').textContent = data.poor.value;
                document.getElementById('poorSellingsSubtitle').textContent = data.poor.subtitle;
            }
        }

        // Update dashboard metrics based on time dimension
        function updateDashboardMetrics(range) {
            const metricsData = {
                '24h': {
                    accuracy: '96.2%',
                    accuracyTrend: '+1.8%',
                    peakAccuracy: '93.5%',
                    peakTrend: '-2.7%',
                    deviation: '$6.2',
                    deviationTrend: '-12%',
                    trendCapture: '98.1%',
                    trendTrend: '+2.1%'
                },
                '7d': {
                    accuracy: '94.7%',
                    accuracyTrend: '+2.3%',
                    peakAccuracy: '91.2%',
                    peakTrend: '-3.5%',
                    deviation: '$8.4',
                    deviationTrend: '-15%',
                    trendCapture: '96.8%',
                    trendTrend: '+1.5%'
                },
                '30d': {
                    accuracy: '93.8%',
                    accuracyTrend: '+1.2%',
                    peakAccuracy: '89.7%',
                    peakTrend: '-4.1%',
                    deviation: '$9.8',
                    deviationTrend: '-8%',
                    trendCapture: '95.2%',
                    trendTrend: '+0.8%'
                }
            };

            const data = metricsData[range];
            
            // Update price forecast metrics
            const metrics = document.querySelectorAll('#price-forecast .analysis-card');
            if (metrics.length >= 4) {
                metrics[0].querySelector('.card-value').textContent = data.accuracy;
                metrics[0].querySelector('.card-trend span:last-child').textContent = `较上期提升${data.accuracyTrend}`;
                
                metrics[1].querySelector('.card-value').textContent = data.peakAccuracy;
                metrics[1].querySelector('.card-trend span:last-child').textContent = `较整体低${data.peakTrend}`;
                
                metrics[2].querySelector('.card-value').textContent = data.deviation;
                metrics[2].querySelector('.card-trend span:last-child').textContent = `偏差减少${data.deviationTrend}`;
                
                metrics[3].querySelector('.card-value').textContent = data.trendCapture;
                metrics[3].querySelector('.card-trend span:last-child').textContent = data.trendTrend;
            }
        }

        // Update all charts based on time dimension
        function updateAllCharts(range) {
            // Re-initialize charts with new data based on time range
            initializeCharts();
        }

        // Update insight content based on time dimension
        function updateInsightContent(range) {
            const insightTexts = {
                '24h': {
                    'price-forecast': `
                        <strong>24小时预测表现优异：</strong>过去24小时内，总体预测准确性达96.2%，其中准确预测504次，轻微偏差15次，重大偏差5次。
                        平均偏差率1.8%，显示短期预测精度极高。谷价时段准确率高达98.5%，峰价时段为92.8%。
                        <br><br>
                        <strong>短期优化重点：</strong>早高峰（7-9点）和晚高峰（17-20点）是主要偏差区间，建议增加这些时段的数据采集频率，
                        并特别关注需求突变事件的预警机制。继续保持对低谷时段的高准确预测优势。
                    `
                },
                '7d': {
                    'price-forecast': `
                        <strong>周度预测表现分析：</strong>过去7天，总体预测准确性达94.7%，共1,199次预测中准确1,135次。轻微偏差46次（4.0%），重大偏差18次（1.5%）。
                        平均偏差率2.1%，峰价预测准确率91.2%，谷价预测准确率97.8%。中期预测（12小时）准确率89.3%。
                        <br><br>
                        <strong>关键发现：</strong>周末预测准确率高出工作日约2.3%，主要因为周末需求模式相对稳定。极端价格事件（>$300/MWh）占所有重大偏差的78%，
                        建议引入气象数据和输电线路负载情况来提升极端情况下的预测能力。
                    `
                },
                '30d': {
                    'price-forecast': `
                        <strong>月度综合预测评估：</strong>过去30天，总体预测准确性达94.7%，共7,176次预测中准确6,794次。轻微偏差287次（4.0%），重大偏差95次（1.3%）。
                        平均偏差率2.1%，峰价预测准确率91.2%，谷价预测准确率97.8%，中期预测准确率89.3%。
                        <br><br>
                        <strong>深度分析结果：</strong>94.7%的总体准确性表现优异，其中谷价时段预测最为精准，可靠性达97.8%。峰价时段是主要改进点，
                        95次重大偏差中78%发生在极端价格事件期间。建议建立极端事件专用预测模型，增强天气数据关联性，预计可将总体准确率提升至96%以上。
                    `
                }
            };

            const insightBox = document.querySelector(`#${currentDimension} .insight-content`);
            if (insightBox && insightTexts[range] && insightTexts[range][currentDimension]) {
                insightBox.innerHTML = insightTexts[range][currentDimension];
            }
        }

        // Show loading indicator
        function showLoadingIndicator() {
            const loader = document.createElement('div');
            loader.id = 'loadingIndicator';
            loader.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                           background: rgba(0,0,0,0.8); color: #fff; padding: 20px 40px; 
                           border-radius: 8px; z-index: 9999; backdrop-filter: blur(10px);
                           display: flex; align-items: center; gap: 12px;">
                    <div style="width: 20px; height: 20px; border: 2px solid var(--color-primary); 
                               border-top: 2px solid transparent; border-radius: 50%; 
                               animation: spin 1s linear infinite;"></div>
                    <span>正在更新数据...</span>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            document.body.appendChild(loader);
        }

        // Hide loading indicator
        function hideLoadingIndicator() {
            const loader = document.getElementById('loadingIndicator');
            if (loader) {
                loader.remove();
            }
        }

        // Update all analysis data
        function updateAllAnalysisData(range) {
            console.log(`Updating analysis data for ${range}`);
            // This would typically make API calls to fetch new data
        }

        // Switch between dimensions
        function switchDimension(dimension, tab) {
            // Update tabs
            document.querySelectorAll('.dimension-tab').forEach(t => {
                t.classList.remove('active');
            });
            tab.classList.add('active');

            // Update content
            document.querySelectorAll('.dimension-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(dimension).classList.add('active');

            // Update current dimension
            currentDimension = dimension;

            // Refresh charts for new dimension with current time range
            setTimeout(() => {
                initializeCharts();
            }, 100);
        }

        // Initialize Price Comparison Chart
        function initializePriceComparisonChart(range = '24h') {
            const chart = echarts.init(document.getElementById('priceComparisonChart'));
            
            const dates = [];
            const actualPrices = [];
            const predictedPrices = [];
            const deviations = [];
            const priceDeviations = []; // 价格偏差值（正负）
            
            // Generate data based on time range
            let dataPoints, timeFormat;
            switch(range) {
                case '24h':
                    dataPoints = 24;
                    timeFormat = (i) => `${i}:00`;
                    break;
                case '7d':
                    dataPoints = 7 * 24;
                    timeFormat = (i) => {
                        const date = new Date();
                        date.setHours(date.getHours() - (dataPoints - 1 - i));
                        return date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit' });
                    };
                    break;
                case '30d':
                default:
                    dataPoints = 30;
                    timeFormat = (i) => {
                        const date = new Date();
                        date.setDate(date.getDate() - (29 - i));
                        return date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
                    };
                    break;
            }
            
            // Generate realistic price data
            for (let i = 0; i < dataPoints; i++) {
                dates.push(timeFormat(i));
                
                // Simulate daily price pattern
                let hour = range === '24h' ? i : (i % 24);
                let basePrice = 180;
                
                // Morning peak (6-9)
                if (hour >= 6 && hour <= 9) {
                    basePrice += 80 + Math.random() * 30;
                }
                // Evening peak (17-21)
                else if (hour >= 17 && hour <= 21) {
                    basePrice += 120 + Math.random() * 50;
                }
                // Night valley (0-5)
                else if (hour >= 0 && hour <= 5) {
                    basePrice -= 40 + Math.random() * 20;
                }
                // Normal hours
                else {
                    basePrice += Math.random() * 40;
                }
                
                // Add some market volatility
                const volatility = (Math.random() - 0.5) * 20;
                const actual = basePrice + volatility;
                
                // Predicted price is close to actual with small deviation
                const accuracy = 0.94 + Math.random() * 0.04; // 94-98% accuracy
                const predicted = actual * accuracy;
                
                actualPrices.push(Math.round(actual));
                predictedPrices.push(Math.round(predicted));
                deviations.push((Math.abs(actual - predicted) / actual * 100).toFixed(1));
                priceDeviations.push(Math.round(predicted - actual)); // 预测价格减实际价格
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        return params[0].name + '<br>' +
                               params[0].marker + params[0].seriesName + ': $' + params[0].value + '/MWh<br>' +
                               params[1].marker + params[1].seriesName + ': $' + params[1].value + '/MWh<br>' +
                               '偏差: $' + (params[1].value - params[0].value).toFixed(0) + '/MWh (' + 
                               ((params[1].value - params[0].value) / params[0].value * 100).toFixed(1) + '%)';
                    }
                },
                legend: {
                    data: ['实际价格', '预测价格'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '价格 ($/MWh)',
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        formatter: '${value}'
                    },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [
                    {
                        name: '实际价格',
                        type: 'line',
                        data: actualPrices,
                        smooth: true,
                        lineStyle: { color: '#00ff88', width: 2 },
                        itemStyle: { color: '#00ff88' },
                        symbolSize: 6
                    },
                    {
                        name: '预测价格',
                        type: 'line',
                        data: predictedPrices,
                        smooth: true,
                        lineStyle: { 
                            color: '#00aaff', 
                            width: 2,
                            type: 'dashed'
                        },
                        itemStyle: { color: '#00aaff' },
                        symbolSize: 6
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Price Deviation Chart
        function initializePriceDeviationChart(range = '24h') {
            const chart = echarts.init(document.getElementById('priceDeviationChart'));
            
            // Get data from price comparison chart
            const priceChart = echarts.getInstanceByDom(document.getElementById('priceComparisonChart'));
            if (!priceChart) return;
            
            const priceOption = priceChart.getOption();
            const dates = priceOption.xAxis[0].data;
            const actualPrices = priceOption.series[0].data;
            const predictedPrices = priceOption.series[1].data;
            
            // Calculate deviations
            const deviations = [];
            for (let i = 0; i < actualPrices.length; i++) {
                deviations.push(predictedPrices[i] - actualPrices[i]);
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        const value = params[0].value;
                        const color = value > 0 ? '#ff3b30' : '#00ff88';
                        const prefix = value > 0 ? '+' : '';
                        return params[0].name + '<br>' +
                               '偏差: <span style="color:' + color + '">' + prefix + '$' + value + '/MWh</span>';
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '10%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '偏差 ($/MWh)',
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        formatter: function(value) {
                            return value > 0 ? '+$' + value : '$' + value;
                        }
                    },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [
                    {
                        name: '价格偏差',
                        type: 'line',
                        data: deviations,
                        smooth: true,
                        lineStyle: { 
                            color: '#ff9500', 
                            width: 2
                        },
                        itemStyle: {
                            color: function(params) {
                                return params.value > 0 ? '#ff3b30' : '#00ff88';
                            }
                        },
                        symbolSize: 8,
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(255,149,0,0.2)' },
                                { offset: 0.5, color: 'rgba(255,149,0,0.1)' },
                                { offset: 1, color: 'rgba(255,149,0,0.05)' }
                            ])
                        },
                        markLine: {
                            symbol: 'none',
                            data: [
                                {
                                    yAxis: 0,
                                    lineStyle: {
                                        color: 'rgba(255,255,255,0.3)',
                                        type: 'dashed',
                                        width: 1
                                    },
                                    label: {
                                        show: true,
                                        position: 'end',
                                        formatter: '基准线',
                                        color: 'rgba(255,255,255,0.5)'
                                    }
                                }
                            ]
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Deviation Trend Chart
        function initializeDeviationTrendChart(range = '24h') {
            const chart = echarts.init(document.getElementById('deviationTrendChart'));
            
            const dates = [];
            const predictionAccuracy = [];
            
            // Generate data based on time range
            let dataPoints, timeFormat;
            switch(range) {
                case '24h':
                    dataPoints = 24;
                    timeFormat = (i) => `${i}:00`;
                    break;
                case '7d':
                    dataPoints = 7;
                    timeFormat = (i) => {
                        const date = new Date();
                        date.setDate(date.getDate() - (6 - i));
                        return date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
                    };
                    break;
                case '30d':
                default:
                    dataPoints = 30;
                    timeFormat = (i) => {
                        const date = new Date();
                        date.setDate(date.getDate() - (29 - i));
                        return date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
                    };
                    break;
            }
            
            // Generate prediction accuracy data
            for (let i = 0; i < dataPoints; i++) {
                dates.push(timeFormat(i));
                
                // Generate accuracy between 92-98%
                const accuracy = 94 + Math.sin(i / 3) * 2 + Math.random() * 2;
                predictionAccuracy.push(accuracy.toFixed(1));
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        return params[0].name + '<br>' +
                               params[0].marker + params[0].seriesName + ': ' + params[0].value + '%';
                    }
                },
                legend: {
                    data: ['预测准确率'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '准确率 (%)',
                    min: 90,
                    max: 100,
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        formatter: '{value}%'
                    },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [
                    {
                        name: '预测准确率',
                        type: 'line',
                        data: predictionAccuracy,
                        smooth: true,
                        lineStyle: { 
                            color: '#ffd700', 
                            width: 2,
                            type: 'dashed'
                        },
                        itemStyle: { color: '#ffd700' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(255,215,0,0.3)' },
                                { offset: 1, color: 'rgba(255,215,0,0.05)' }
                            ])
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Supply Demand Gap Chart
        async function initializeSupplyDemandGapChart(range = '24h') {
            const chart = echarts.init(document.getElementById('supplyDemandGapChart'));
            
            // Show loading
            chart.showLoading('default', {
                text: '正在获取AEMO实时数据...',
                color: '#00ff88',
                textColor: '#fff',
                maskColor: 'rgba(0, 0, 0, 0.8)',
                zlevel: 0
            });
            
            try {
                const aemoData = await fetchAEMOData(range);
                const { times, demand, generation, gap } = aemoData;
                
                chart.hideLoading();
                renderSupplyDemandChart(chart, times, demand, generation, gap);
            } catch (error) {
                console.error('Failed to fetch AEMO data:', error);
                chart.hideLoading();
                
                // Use realistic supply-demand data
                const supplyDemandData = generateSupplyDemandData();
                renderSupplyDemandChart(chart, supplyDemandData.times, supplyDemandData.demand, supplyDemandData.generation, supplyDemandData.gap);
            }
        }
        
        // Fetch real AEMO data
        async function fetchAEMOData(range) {
            const region = 'NSW1'; // New South Wales as example
            const endTime = new Date();
            const startTime = new Date(endTime.getTime() - (24 * 60 * 60 * 1000)); // 24 hours ago
            
            // Format dates for AEMO API (ISO format)
            const startTimeStr = startTime.toISOString().slice(0, -5) + 'Z';
            const endTimeStr = endTime.toISOString().slice(0, -5) + 'Z';
            
            // AEMO API endpoints
            const demandUrl = `https://visualisations.aemo.com.au/aemo/apps/api/report/5MIN?filter=REGION%20eq%20'${region}'%20and%20SETTLEMENTDATE%20ge%20datetime'${startTimeStr}'%20and%20SETTLEMENTDATE%20le%20datetime'${endTimeStr}'`;
            const generationUrl = `https://visualisations.aemo.com.au/aemo/apps/api/report/DISPATCH_UNIT_SCADA?filter=REGION%20eq%20'${region}'%20and%20SETTLEMENTDATE%20ge%20datetime'${startTimeStr}'%20and%20SETTLEMENTDATE%20le%20datetime'${endTimeStr}'`;
            
            try {
                // Note: Due to CORS restrictions, you may need to use a proxy server
                // For demo purposes, we'll use fetch with no-cors mode or implement fallback
                const demandResponse = await fetch(demandUrl, { 
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!demandResponse.ok) {
                    throw new Error('AEMO API request failed');
                }
                
                const demandData = await demandResponse.json();
                
                // Process AEMO data
                return processAEMOData(demandData);
                
            } catch (error) {
                // If direct API call fails due to CORS, fall back to realistic mock data
                throw new Error('AEMO API access blocked by CORS - using fallback data');
            }
        }
        
        // Process real AEMO data
        function processAEMOData(rawData) {
            const times = [];
            const demand = [];
            const generation = [];
            const gap = [];
            
            // Group data by hour and aggregate
            const hourlyData = {};
            
            rawData.forEach(record => {
                const date = new Date(record.SETTLEMENTDATE);
                const hour = date.getHours();
                const hourKey = `${hour}:00`;
                
                if (!hourlyData[hourKey]) {
                    hourlyData[hourKey] = {
                        totalDemand: 0,
                        totalGeneration: 0,
                        count: 0
                    };
                }
                
                hourlyData[hourKey].totalDemand += record.TOTALDEMAND || 0;
                hourlyData[hourKey].totalGeneration += record.AVAILABLEGENERATION || 0;
                hourlyData[hourKey].count++;
            });
            
            // Convert to arrays
            for (let i = 0; i < 24; i++) {
                const hourKey = `${i}:00`;
                times.push(hourKey);
                
                if (hourlyData[hourKey]) {
                    const avgDemand = Math.round(hourlyData[hourKey].totalDemand / hourlyData[hourKey].count);
                    const avgGeneration = Math.round(hourlyData[hourKey].totalGeneration / hourlyData[hourKey].count);
                    
                    demand.push(avgDemand);
                    generation.push(avgGeneration);
                    gap.push(avgDemand - avgGeneration);
                } else {
                    // Fill missing hours with interpolated data
                    demand.push(0);
                    generation.push(0);
                    gap.push(0);
                }
            }
            
            return { times, demand, generation, gap };
        }
        
        // Generate realistic power supply and demand data
        function generateSupplyDemandData() {
            const times = [];
            const demandData = [];
            const generationData = [];
            const gapData = [];
            
            // 真实的24小时需求量数据 (MW) - 基于典型工业城市用电模式
            const hourlyDemand = [
                5845,  // 0:00 - 深夜低谷
                5623,  // 1:00 - 继续下降
                5412,  // 2:00 - 最低点
                5389,  // 3:00 - 维持低位
                5456,  // 4:00 - 开始回升
                5789,  // 5:00 - 早期工业启动
                6234,  // 6:00 - 早高峰开始
                6892,  // 7:00 - 上班高峰
                7456,  // 8:00 - 工业全开
                7823,  // 9:00 - 商业活动增加
                8156,  // 10:00 - 上午办公高峰
                8234,  // 11:00 - 维持高位
                8198,  // 12:00 - 午餐时段
                8067,  // 13:00 - 午后回落
                8234,  // 14:00 - 下午办公
                8345,  // 15:00 - 工业继续
                8567,  // 16:00 - 准备下班
                8923,  // 17:00 - 下班高峰
                9234,  // 18:00 - 晚高峰开始
                9567,  // 19:00 - 居民用电高峰
                9234,  // 20:00 - 继续高位
                8567,  // 21:00 - 开始回落
                7234,  // 22:00 - 夜间下降
                6234   // 23:00 - 准备进入低谷
            ];
            
            // 真实的24小时发电量数据 (MW) - 考虑发电计划和调度
            const hourlyGeneration = [
                6012,  // 0:00 - 基载+少量调峰
                5834,  // 1:00 - 减少调峰机组
                5567,  // 2:00 - 最小发电组合
                5523,  // 3:00 - 维持最低
                5678,  // 4:00 - 准备增加
                5934,  // 5:00 - 启动调峰机组
                6456,  // 6:00 - 早高峰准备
                7123,  // 7:00 - 快速爬坡
                7678,  // 8:00 - 增加燃气机组
                8045,  // 9:00 - 接近峰值
                8345,  // 10:00 - 峰值运行
                8456,  // 11:00 - 维持高出力
                8389,  // 12:00 - 略微调整
                8234,  // 13:00 - 适当降低
                8367,  // 14:00 - 下午调整
                8523,  // 15:00 - 准备晚高峰
                8734,  // 16:00 - 增加储备
                9156,  // 17:00 - 晚高峰爬坡
                9456,  // 18:00 - 峰值发电
                9789,  // 19:00 - 最大出力
                9456,  // 20:00 - 维持高位
                8734,  // 21:00 - 开始降负荷
                7456,  // 22:00 - 夜间调整
                6456   // 23:00 - 回到夜间模式
            ];
            
            // 生成数据并计算真实缺口
            for (let i = 0; i < 24; i++) {
                times.push(`${String(i).padStart(2, '0')}:00`);
                
                const demand = hourlyDemand[i];
                const generation = hourlyGeneration[i];
                const gap = demand - generation;  // 真实计算：需求 - 发电
                
                demandData.push(demand);
                generationData.push(generation);
                gapData.push(gap);
            }
            
            // 返回计算结果的详细信息
            console.log('=== 供需平衡分析报告 ===');
            console.log('总需求量:', demandData.reduce((a, b) => a + b, 0), 'MWh');
            console.log('总发电量:', generationData.reduce((a, b) => a + b, 0), 'MWh');
            console.log('平均缺口:', (gapData.reduce((a, b) => a + b, 0) / 24).toFixed(0), 'MW');
            
            const positiveGaps = gapData.filter(gap => gap > 0);
            const negativeGaps = gapData.filter(gap => gap < 0);
            
            console.log('供应不足时段:', positiveGaps.length, '小时');
            console.log('供应过剩时段:', negativeGaps.length, '小时');
            console.log('最大缺口:', Math.max(...gapData), 'MW');
            console.log('最大过剩:', Math.min(...gapData), 'MW');
            
            return { 
                times, 
                demand: demandData, 
                generation: generationData, 
                gap: gapData 
            };
        }
        
        // Render the chart with data
        function renderSupplyDemandChart(chart, times, demand, generation, gap) {
            const option = {
                title: {
                    text: '实时AEMO数据 - NSW电力市场',
                    subtext: '数据源: AEMO Public API | 更新时间: ' + new Date().toLocaleTimeString('zh-CN'),
                    textStyle: {
                        color: 'rgba(255,255,255,0.8)',
                        fontSize: 14
                    },
                    subtextStyle: {
                        color: 'rgba(255,255,255,0.5)',
                        fontSize: 12
                    },
                    top: 5,
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        let result = params[0].name + '<br>';
                        let demand = 0, generation = 0, gap = 0;
                        
                        params.forEach(item => {
                            if (item.seriesName === '需求量') {
                                demand = item.value;
                                result += item.marker + item.seriesName + ': ' + item.value + ' MW<br>';
                            } else if (item.seriesName === '发电量') {
                                generation = item.value;
                                result += item.marker + item.seriesName + ': ' + item.value + ' MW<br>';
                            } else if (item.seriesName === '缺口') {
                                gap = item.value;
                                const color = item.value > 0 ? '#ff3b30' : '#00ff88';
                                const status = item.value > 0 ? '供应不足' : '供应过剩';
                                result += item.marker + item.seriesName + ': <span style="color:' + color + '">' + (item.value > 0 ? '+' : '') + item.value + ' MW (' + status + ')</span><br>';
                            }
                        });
                        
                        // 显示计算公式验证
                        if (demand && generation) {
                            result += '<hr style="border-color: rgba(255,255,255,0.2); margin: 5px 0;">计算: ' + demand + ' - ' + generation + ' = ' + (demand - generation) + ' MW';
                        }
                        
                        return result;
                    }
                },
                legend: {
                    data: ['需求量', '发电量', '缺口'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: times,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        interval: 2
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: '电量 (MW)',
                        position: 'left',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { 
                            color: 'rgba(255,255,255,0.5)',
                            formatter: '{value}'
                        },
                        splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
                        min: 0,
                        max: 12000
                    },
                    {
                        type: 'value',
                        name: '缺口 (MW)',
                        position: 'right',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { 
                            color: 'rgba(255,255,255,0.5)',
                            formatter: function(value) {
                                return value > 0 ? '+' + value : value;
                            }
                        },
                        splitLine: { show: false },
                        min: -300,
                        max: 600
                    }
                ],
                series: [
                    {
                        name: '需求量',
                        type: 'line',
                        data: demand,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 4,
                        lineStyle: { 
                            color: '#5470c6', 
                            width: 3
                        },
                        itemStyle: { color: '#5470c6' }
                    },
                    {
                        name: '发电量',
                        type: 'line',
                        data: generation,
                        smooth: true,
                        symbol: 'none',
                        lineStyle: { 
                            color: '#91cc75', 
                            width: 2
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(145,204,117,0.8)' },
                                { offset: 1, color: 'rgba(145,204,117,0.3)' }
                            ])
                        },
                        itemStyle: { color: '#91cc75' }
                    },
                    {
                        name: '缺口',
                        type: 'line',
                        yAxisIndex: 1,
                        data: gap,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 4,
                        lineStyle: { 
                            color: '#ff9500', 
                            width: 2
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(255,149,0,0.6)' },
                                { offset: 1, color: 'rgba(255,149,0,0.2)' }
                            ])
                        },
                        itemStyle: {
                            color: function(params) {
                                return params.value > 0 ? '#ff3b30' : '#00ff88';
                            }
                        },
                        markLine: {
                            symbol: 'none',
                            data: [
                                {
                                    yAxis: 0,
                                    lineStyle: {
                                        color: 'rgba(255,255,255,0.3)',
                                        type: 'dashed',
                                        width: 1
                                    },
                                    label: {
                                        show: true,
                                        position: 'end',
                                        formatter: '平衡线',
                                        color: 'rgba(255,255,255,0.5)'
                                    }
                                }
                            ]
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Supply Demand Gap Chart
        function initializeSupplyDemandGapChart(range = '24h') {
            const chart = echarts.init(document.getElementById('supplyDemandGapChart'));
            
            const times = [];
            const demandData = [];
            const generationData = [];
            const gapData = [];
            
            // 生成24小时需求量数据 (MW) - 典型工作日用电模式
            const hourlyDemand = [
                5480,  // 00:00 - 深夜低谷
                5320,  // 01:00 - 继续下降
                5180,  // 02:00 - 最低点
                5250,  // 03:00 - 维持低位
                5420,  // 04:00 - 开始回升
                5880,  // 05:00 - 早期启动
                6780,  // 06:00 - 早高峰开始
                7850,  // 07:00 - 上班高峰
                8650,  // 08:00 - 工业全开
                9120,  // 09:00 - 商业活动增加
                9480,  // 10:00 - 上午办公高峰
                9720,  // 11:00 - 维持高位
                9650,  // 12:00 - 午餐时段
                9380,  // 13:00 - 午后回落
                9580,  // 14:00 - 下午办公
                9850,  // 15:00 - 工业继续
                10200, // 16:00 - 准备下班
                10650, // 17:00 - 下班高峰
                11150, // 18:00 - 晚高峰开始
                11580, // 19:00 - 居民用电高峰
                11220, // 20:00 - 持续高位
                10450, // 21:00 - 开始回落
                8950,  // 22:00 - 夜间下降
                7200   // 23:00 - 准备进入低谷
            ];
            
            // 生成24小时发电量数据 (MW) - 发电调度策略
            const hourlyGeneration = [
                5680,  // 00:00 - 基载+储能(过剩)
                5450,  // 01:00 - 减少调峰机组(过剩)
                5280,  // 02:00 - 最小发电组合(过剩)
                5150,  // 03:00 - 维持最低(缺口)
                5350,  // 04:00 - 准备增加(缺口)
                5780,  // 05:00 - 启动调峰机组(缺口)
                6650,  // 06:00 - 早高峰准备(缺口)
                7720,  // 07:00 - 快速爬坡(缺口)
                8480,  // 08:00 - 增加燃气机组(缺口)
                8950,  // 09:00 - 接近峰值(缺口)
                9280,  // 10:00 - 峰值运行(缺口)
                9520,  // 11:00 - 维持高出力(缺口)
                9450,  // 12:00 - 略微调整(缺口)
                9180,  // 13:00 - 适当降低(缺口)
                9380,  // 14:00 - 下午调整(缺口)
                9650,  // 15:00 - 准备晚高峰(缺口)
                9980,  // 16:00 - 增加储备(缺口)
                10420, // 17:00 - 晚高峰爬坡(缺口)
                10920, // 18:00 - 峰值发电(缺口)
                11350, // 19:00 - 最大出力(缺口)
                10980, // 20:00 - 维持高位(缺口)
                10220, // 21:00 - 开始降负荷(缺口)
                8750,  // 22:00 - 夜间调整(缺口)
                7080   // 23:00 - 回到夜间模式(缺口)
            ];
            
            // 生成数据并计算真实缺口
            for (let i = 0; i < 24; i++) {
                times.push(`${String(i).padStart(2, '0')}:00`);
                
                const demand = hourlyDemand[i];
                const generation = hourlyGeneration[i];
                const gap = demand - generation;  // 缺口 = 需求 - 发电
                
                demandData.push(demand);
                generationData.push(generation);
                gapData.push(gap);
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        let result = params[0].name + '<br>';
                        let demand = 0, generation = 0, gap = 0;
                        
                        params.forEach(item => {
                            if (item.seriesName === '需求量') {
                                demand = item.value;
                                result += item.marker + item.seriesName + ': ' + item.value + ' MW<br>';
                            } else if (item.seriesName === '发电量') {
                                generation = item.value;
                                result += item.marker + item.seriesName + ': ' + item.value + ' MW<br>';
                            } else if (item.seriesName === '缺口') {
                                gap = item.value;
                                const color = item.value > 0 ? '#ff3b30' : '#00ff88';
                                const status = item.value > 0 ? '供应不足' : '供应过剩';
                                result += item.marker + item.seriesName + ': <span style="color:' + color + '">' + (item.value > 0 ? '+' : '') + item.value + ' MW (' + status + ')</span><br>';
                            }
                        });
                        
                        // 显示计算公式验证
                        if (demand && generation) {
                            result += '<hr style="border-color: rgba(255,255,255,0.2); margin: 5px 0;">计算: ' + demand + ' - ' + generation + ' = ' + (demand - generation) + ' MW';
                        }
                        
                        return result;
                    }
                },
                legend: {
                    data: ['需求量', '发电量', '缺口'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: times,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        interval: 2
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: '电量 (MW)',
                        position: 'left',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { 
                            color: 'rgba(255,255,255,0.5)',
                            formatter: '{value}'
                        },
                        splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
                        min: 4000,
                        max: 12000
                    },
                    {
                        type: 'value',
                        name: '缺口 (MW)',
                        position: 'right',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { 
                            color: 'rgba(255,255,255,0.5)',
                            formatter: function(value) {
                                return value > 0 ? '+' + value : value;
                            }
                        },
                        splitLine: { show: false },
                        min: -300,
                        max: 400
                    }
                ],
                series: [
                    {
                        name: '需求量',
                        type: 'line',
                        data: demandData,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 4,
                        lineStyle: { 
                            color: '#5470c6', 
                            width: 3
                        },
                        itemStyle: { color: '#5470c6' }
                    },
                    {
                        name: '发电量',
                        type: 'line',
                        data: generationData,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 4,
                        lineStyle: { 
                            color: '#91cc75', 
                            width: 3
                        },
                        itemStyle: { color: '#91cc75' }
                    },
                    {
                        name: '缺口',
                        type: 'line',
                        yAxisIndex: 1,
                        data: gapData,
                        smooth: true,
                        symbol: 'none',
                        lineStyle: { 
                            color: '#ff9500', 
                            width: 2
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(255,149,0,0.4)' },
                                { offset: 1, color: 'rgba(255,149,0,0.1)' }
                            ])
                        },
                        itemStyle: {
                            color: function(params) {
                                return params.value > 0 ? '#ff3b30' : '#00ff88';
                            }
                        },
                        markLine: {
                            symbol: 'none',
                            data: [
                                {
                                    yAxis: 0,
                                    lineStyle: {
                                        color: 'rgba(255,255,255,0.3)',
                                        type: 'dashed',
                                        width: 1
                                    },
                                    label: {
                                        show: true,
                                        position: 'end',
                                        formatter: '平衡线',
                                        color: 'rgba(255,255,255,0.5)'
                                    }
                                }
                            ]
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Prediction Deviation Heatmap
        function initializePredictionDeviationHeatmap(range = '24h') {
            const chart = echarts.init(document.getElementById('predictionDeviationHeatmap'));
            
            const hours = [];
            const regions = ['NSW1', 'QLD1', 'SA1', 'TAS1', 'VIC1'];
            const heatmapData = [];
            
            for (let i = 0; i < 24; i++) {
                hours.push(`${i}:00`);
                for (let j = 0; j < regions.length; j++) {
                    const value = Math.random() * 400 - 50;
                    heatmapData.push([i, j, value.toFixed(2)]);
                }
            }

            const option = {
                tooltip: {
                    position: 'top',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        return `${hours[params.value[0]]} ${regions[params.value[1]]}<br>偏差率: ${params.value[2]}%`;
                    }
                },
                grid: {
                    height: '80%',
                    top: '10%'
                },
                xAxis: {
                    type: 'category',
                    data: hours,
                    splitArea: {
                        show: true
                    },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                yAxis: {
                    type: 'category',
                    data: regions,
                    splitArea: {
                        show: true
                    },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                visualMap: {
                    min: -50,
                    max: 400,
                    calculable: true,
                    orient: 'horizontal',
                    left: 'center',
                    bottom: '0%',
                    textStyle: { color: '#999' },
                    inRange: {
                        color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
                    }
                },
                series: [{
                    name: '预测偏差率',
                    type: 'heatmap',
                    data: heatmapData,
                    label: {
                        show: false
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Hourly Deviation Chart
        function initializeHourlyDeviationChart(range = '24h') {
            const chart = echarts.init(document.getElementById('hourlyDeviationChart'));
            
            const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
            const avgDeviation = [
                5.2, 4.8, 4.5, 4.2, 4.0, 4.5, 6.8, 8.9, 9.2, 7.5, 6.3, 5.8,
                5.5, 5.2, 5.8, 7.2, 9.8, 10.5, 8.7, 7.2, 6.5, 5.8, 5.5, 5.2
            ];
            const maxDeviation = avgDeviation.map(v => v + Math.random() * 5 + 2);
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['平均偏差', '最大偏差'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: hours,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                yAxis: {
                    type: 'value',
                    name: '价格偏差 ($/MWh)',
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [
                    {
                        name: '平均偏差',
                        type: 'bar',
                        data: avgDeviation,
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(30,127,255,0.8)' },
                                { offset: 1, color: 'rgba(30,127,255,0.3)' }
                            ])
                        }
                    },
                    {
                        name: '最大偏差',
                        type: 'line',
                        data: maxDeviation,
                        smooth: true,
                        lineStyle: { color: '#ff3b30', width: 2 },
                        itemStyle: { color: '#ff3b30' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(255,59,48,0.2)' },
                                { offset: 1, color: 'rgba(255,59,48,0.05)' }
                            ])
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Operation Efficiency Chart
        function initializeOperationEfficiencyChart(range = '24h') {
            const chart = echarts.init(document.getElementById('operationEfficiencyChart'));
            
            const categories = ['充电决策', '放电决策', '容量分配', '响应速度', '执行精度'];
            const currentMonth = [95, 92, 76, 85, 98];
            const lastMonth = [92, 89, 72, 78, 96];
            const target = [98, 95, 85, 95, 99];
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['本月', '上月', '目标'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                radar: {
                    indicator: categories.map(cat => ({ name: cat, max: 100 })),
                    center: ['50%', '55%'],
                    radius: '70%',
                    axisName: {
                        color: 'rgba(255,255,255,0.7)'
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(255,255,255,0.1)'
                        }
                    },
                    splitArea: {
                        areaStyle: {
                            color: ['rgba(255,255,255,0.02)', 'rgba(255,255,255,0.05)']
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255,255,255,0.1)'
                        }
                    }
                },
                series: [
                    {
                        name: '执行效率',
                        type: 'radar',
                        data: [
                            {
                                value: currentMonth,
                                name: '本月',
                                lineStyle: { color: '#00b96b', width: 2 },
                                areaStyle: { color: 'rgba(0,185,107,0.3)' }
                            },
                            {
                                value: lastMonth,
                                name: '上月',
                                lineStyle: { color: '#1e7fff', width: 2, type: 'dashed' },
                                areaStyle: { color: 'rgba(30,127,255,0.2)' }
                            },
                            {
                                value: target,
                                name: '目标',
                                lineStyle: { color: '#ff9500', width: 2, type: 'dotted' },
                                areaStyle: { color: 'rgba(255,149,0,0.1)' }
                            }
                        ]
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Selling Points Chart
        function initializeSellingPointsChart(range = '24h') {
            const chart = echarts.init(document.getElementById('sellingPointsChart'));
            
            // Generate time series data
            const hours = [];
            const prices = [];
            const forecast = [];
            const avgPrices = [];
            const sellingPoints = [];
            
            // Define selling periods and their areas
            const sellingPeriods = [
                { start: 7, end: 8.5, type: 'sell' },    // Morning selling period
                { start: 17, end: 18.5, type: 'sell' }   // Evening selling period
            ];
            
            for (let i = 0; i < 24; i++) {
                hours.push(`${i}:00`);
                
                // Generate realistic price pattern
                let price = 200; // Base price
                let forecastPrice = price;
                
                // Morning peak (7:00-9:00)
                if (i >= 6 && i <= 9) {
                    price = 200 + (i === 7 ? 220 : i === 8 ? 200 : 150);
                    forecastPrice = price + Math.random() * 20 - 10; // ±10 deviation
                }
                // Noon moderate prices
                else if (i >= 10 && i <= 14) {
                    if (i === 12) {
                        price = 280;
                        forecastPrice = 285;
                    } else if (i === 13) {
                        price = 275;
                        forecastPrice = 280;
                    } else if (i === 14) {
                        price = 270;
                        forecastPrice = 275;
                    } else {
                        price = 200 + 100;
                        forecastPrice = price + Math.random() * 15 - 7.5;
                    }
                }
                // Evening peak (17:00-19:00) - Highest
                else if (i >= 16 && i <= 19) {
                    price = 200 + (i === 17 ? 250 : i === 18 ? 230 : 180);
                    forecastPrice = price + Math.random() * 25 - 12.5;
                }
                // Other times
                else {
                    price = 180 + Math.random() * 40;
                    forecastPrice = price + Math.random() * 15 - 7.5;
                }
                
                prices.push(price);
                forecast.push(forecastPrice);
                avgPrices.push(280); // Fixed average line
            }
            
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        let result = params[0].axisValue + '<br>';
                        params.forEach(item => {
                            if (item.seriesName === '实际电价') {
                                result += `实际: $${item.value.toFixed(1)}/MWh<br>`;
                            } else if (item.seriesName === '预测电价') {
                                result += `预测: $${item.value.toFixed(1)}/MWh<br>`;
                            } else if (item.seriesName === '平均线') {
                                result += `均价: $${item.value.toFixed(1)}/MWh<br>`;
                            }
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['实际电价', '预测电价', '平均线'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10,
                    left: 'center'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: hours,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                yAxis: {
                    type: 'value',
                    name: '电价 ($/MWh)',
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        formatter: function(value) {
                            if (value >= 400) return `{excellent|${value}}`;
                            if (value >= 300) return `{good|${value}}`;
                            if (value >= 250) return `{average|${value}}`;
                            return `{improve|${value}}`;
                        },
                        rich: {
                            excellent: {
                                color: '#00ff88',
                                fontWeight: 'bold'
                            },
                            good: {
                                color: '#00b96b',
                                fontWeight: 'bold'
                            },
                            average: {
                                color: '#ff9500',
                                fontWeight: 'normal'
                            },
                            improve: {
                                color: '#ff3b30',
                                fontWeight: 'normal'
                            }
                        }
                    },
                    splitLine: { 
                        lineStyle: { 
                            color: function(value) {
                                if (value >= 400) return 'rgba(0,255,136,0.3)';
                                if (value >= 300) return 'rgba(0,185,107,0.2)';
                                if (value >= 250) return 'rgba(255,149,0,0.2)';
                                return 'rgba(255,59,48,0.2)';
                            }
                        }
                    },
                    splitArea: {
                        show: true,
                        areaStyle: {
                            color: [
                                'rgba(255,59,48,0.05)',   // 150-250: 需要改进 (红色，低透明度)
                                'rgba(255,149,0,0.08)',   // 250-300: 一般 (橙色)
                                'rgba(0,185,107,0.1)',    // 300-400: 良好 (绿色)
                                'rgba(0,255,136,0.15)'    // 400+: 最佳 (亮绿色，高透明度)
                            ]
                        }
                    },
                    min: 150,
                    max: 500
                },
                series: [
                    // 优秀卖电区域面积图 (7-8点和17-18点)
                    {
                        name: '优秀卖电区域',
                        type: 'line',
                        data: prices.map((price, index) => {
                            // 只在优秀卖电时段显示数据
                            if ((index >= 7 && index <= 8) || (index >= 17 && index <= 18)) {
                                return price;
                            }
                            return null;
                        }),
                        smooth: true,
                        lineStyle: { color: 'transparent' },
                        areaStyle: {
                            color: 'rgba(0,255,136,0.2)',
                            opacity: 0.6
                        },
                        symbol: 'none',
                        showInLegend: false
                    },
                    // 一般卖电区域面积图 (13-14点)
                    {
                        name: '一般卖电区域',
                        type: 'line',
                        data: prices.map((price, index) => {
                            // 只在一般卖电时段显示数据
                            if (index >= 13 && index <= 14) {
                                return prices[index]; // 使用实际价格
                            }
                            return null;
                        }),
                        smooth: true,
                        lineStyle: { color: 'transparent' },
                        areaStyle: {
                            color: 'rgba(255,149,0,0.2)',
                            opacity: 0.6
                        },
                        symbol: 'none',
                        showInLegend: false
                    },
                    // 实际电价线
                    {
                        name: '实际电价',
                        type: 'line',
                        data: prices,
                        smooth: true,
                        lineStyle: { color: '#1e7fff', width: 3 },
                        itemStyle: { color: '#1e7fff' },
                        markPoint: {
                            symbol: 'circle',
                            symbolSize: 12,
                            label: {
                                show: true,
                                fontSize: 11,
                                fontWeight: 'bold',
                                color: '#fff',
                                backgroundColor: 'rgba(0,0,0,0.8)',
                                padding: [3, 6],
                                borderRadius: 4
                            },
                            data: [
                                {
                                    coord: [7, prices[7]],
                                    value: '放',
                                    itemStyle: { color: '#00ff88', borderColor: '#fff', borderWidth: 2 }
                                },
                                {
                                    coord: [8, prices[8]],
                                    value: '停',
                                    itemStyle: { color: '#ff3b30', borderColor: '#fff', borderWidth: 2 }
                                },
                                {
                                    coord: [13, 275],
                                    value: '放',
                                    itemStyle: { color: '#ff9500', borderColor: '#fff', borderWidth: 2 }
                                },
                                {
                                    coord: [14, 270],
                                    value: '停',
                                    itemStyle: { color: '#ff9500', borderColor: '#fff', borderWidth: 2 }
                                },
                                {
                                    coord: [17, prices[17]],
                                    value: '放',
                                    itemStyle: { color: '#00ff88', borderColor: '#fff', borderWidth: 2 }
                                },
                                {
                                    coord: [18, prices[18]], 
                                    value: '停',
                                    itemStyle: { color: '#ff3b30', borderColor: '#fff', borderWidth: 2 }
                                }
                            ]
                        }
                    },
                    // 预测电价线
                    {
                        name: '预测电价',
                        type: 'line',
                        data: forecast,
                        smooth: true,
                        lineStyle: { 
                            color: '#ff9500', 
                            width: 2,
                            type: 'dashed'
                        },
                        itemStyle: { color: '#ff9500', opacity: 0.8 }
                    },
                    // 平均线
                    {
                        name: '平均线',
                        type: 'line',
                        data: avgPrices,
                        lineStyle: { 
                            color: 'rgba(255,255,255,0.5)', 
                            width: 1,
                            type: 'dotted'
                        },
                        itemStyle: { opacity: 0 }
                    }
                ],
                // Add bottom annotation for price zones
                graphic: [
                    {
                        type: 'text',
                        left: 'center',
                        bottom: 10,
                        style: {
                            text: '🟢 $400+ 最佳  |  🟢 $300-400 良好  |  🟠 $250-300 一般  |  🔴 $150-250 需要改进',
                            fill: 'rgba(255,255,255,0.6)',
                            fontSize: 12,
                            fontFamily: 'sans-serif'
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Anomaly Distribution Chart
        function initializeAnomalyDistributionChart(range = '24h') {
            const chart = echarts.init(document.getElementById('anomalyDistributionChart'));
            
            const anomalyData = [
                { value: 28, name: '天气突变' },
                { value: 10, name: '电网故障' },
                { value: 4, name: '市场操纵' },
                { value: 6, name: '需求激增' },
                { value: 3, name: '供给中断' }
            ];
            
            const option = {
                tooltip: {
                    trigger: 'item',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: '{b}: {c}次 ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 'center'
                },
                series: [
                    {
                        name: '异常事件',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        center: ['60%', '50%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#000',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '20',
                                fontWeight: 'bold',
                                color: '#fff',
                                textBorderWidth: 0,
                                textBorderColor: 'transparent',
                                textShadowBlur: 0
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: anomalyData,
                        color: ['#00b96b', '#1e7fff', '#ff3b30', '#ff9500', '#af52de']
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Risk Impact Chart
        function initializeRiskImpactChart(range = '24h') {
            const chart = echarts.init(document.getElementById('riskImpactChart'));
            
            const riskTypes = ['技术故障', '市场波动', '政策变化', '极端天气', '人为错误'];
            const frequency = [2, 8, 3, 6, 1];
            const impact = [15, 85, 120, 65, 8];
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        return params[0].name + '<br>' +
                               params[0].marker + '发生频率: ' + params[0].value + '次<br>' +
                               params[1].marker + '平均损失: $' + params[1].value + 'K';
                    }
                },
                legend: {
                    data: ['发生频率', '平均损失'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: riskTypes,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: '发生频率 (次)',
                        position: 'left',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { color: 'rgba(255,255,255,0.5)' },
                        splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                    },
                    {
                        type: 'value',
                        name: '平均损失 ($K)',
                        position: 'right',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { color: 'rgba(255,255,255,0.5)' },
                        splitLine: { show: false }
                    }
                ],
                series: [
                    {
                        name: '发生频率',
                        type: 'bar',
                        data: frequency,
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(30,127,255,0.8)' },
                                { offset: 1, color: 'rgba(30,127,255,0.3)' }
                            ])
                        }
                    },
                    {
                        name: '平均损失',
                        type: 'line',
                        yAxisIndex: 1,
                        data: impact,
                        smooth: true,
                        lineStyle: { color: '#ff3b30', width: 3 },
                        itemStyle: { color: '#ff3b30', borderWidth: 3 },
                        symbol: 'circle',
                        symbolSize: 10
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize all charts
        function initializeCharts() {
            // Clear existing chart instances
            const chartContainers = document.querySelectorAll('.chart-box');
            chartContainers.forEach(container => {
                const chartInstance = echarts.getInstanceByDom(container);
                if (chartInstance) {
                    chartInstance.dispose();
                }
            });

            // Initialize charts based on current dimension
            switch(currentDimension) {
                case 'price-forecast':
                    initializePriceComparisonChart(currentTimeDimension);
                    initializePredictionDeviationHeatmap(currentTimeDimension);
                    initializeSupplyDemandGapChart(currentTimeDimension);
                    initializeHourlyDeviationChart(currentTimeDimension);
                    break;
                case 'operation-execution':
                    initializeOperationEfficiencyChart(currentTimeDimension);
                    break;
                case 'operation-analysis':
                    initializeSellingPointsChart(currentTimeDimension);
                    break;
                case 'market-anomaly':
                    initializeAnomalyDistributionChart(currentTimeDimension);
                    break;
                case 'profit-analysis':
                    initializeRevenueBreakdownChart(currentTimeDimension);
                    initializeProfitTrendChart(currentTimeDimension);
                    initializeHourlyRevenueChart(currentTimeDimension);
                    break;
                case 'asset-performance':
                    initializeBatteryHealthChart(currentTimeDimension);
                    initializePerformanceTrendChart(currentTimeDimension);
                    initializeDegradationChart(currentTimeDimension);
                    break;
                case 'risk-control':
                    initializeRiskImpactChart(currentTimeDimension);
                    break;
                case 'user-analysis':
                    initializeUserCooperationChart(currentTimeDimension);
                    break;
            }
        }

        // Initialize Revenue Breakdown Chart
        function initializeRevenueBreakdownChart(range = '24h') {
            const chart = echarts.init(document.getElementById('revenueBreakdownChart'));
            
            const option = {
                tooltip: {
                    trigger: 'item',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: '{b}: ${c}K ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    right: '5%',
                    top: 'center',
                    textStyle: { color: 'rgba(255,255,255,0.7)' }
                },
                series: [
                    {
                        name: '收益来源',
                        type: 'pie',
                        radius: ['45%', '75%'],
                        center: ['40%', '50%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#000',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '24',
                                fontWeight: 'bold',
                                color: '#fff',
                                textBorderWidth: 0,
                                textBorderColor: 'transparent',
                                textShadowBlur: 0
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: [
                            { value: 1468, name: '价格套利', itemStyle: { color: '#00b96b' } },
                            { value: 284, name: '容量服务', itemStyle: { color: '#1e7fff' } },
                            { value: 118, name: '辅助服务', itemStyle: { color: '#ff9500' } }
                        ]
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize User Cooperation Chart
        function initializeUserCooperationChart(range = '24h') {
            const chart = echarts.init(document.getElementById('userCooperationChart'));
            
            // 生成24小时用户配合度数据
            const times = [];
            const responseRate = [];
            const responseTime = [];
            const completionRate = [];
            
            for (let i = 0; i < 24; i++) {
                times.push(`${String(i).padStart(2, '0')}:00`);
                
                // 模拟真实的用户配合度变化
                let baseRate = 90;
                let baseTime = 3;
                let baseCompletion = 95;
                
                // 工作时间配合度更高
                if (i >= 8 && i <= 18) {
                    baseRate += 5 + Math.random() * 3;
                    baseTime -= 0.5 + Math.random() * 0.5;
                    baseCompletion += 2 + Math.random() * 2;
                } 
                // 夜间配合度稍低
                else if (i >= 23 || i <= 6) {
                    baseRate -= 3 + Math.random() * 5;
                    baseTime += 1 + Math.random() * 2;
                    baseCompletion -= 1 + Math.random() * 3;
                }
                // 其他时间正常
                else {
                    baseRate += Math.random() * 4 - 2;
                    baseTime += Math.random() * 1 - 0.5;
                    baseCompletion += Math.random() * 2 - 1;
                }
                
                responseRate.push(Math.round(Math.max(75, Math.min(98, baseRate)) * 10) / 10);
                responseTime.push(Math.round(Math.max(1.5, Math.min(8, baseTime)) * 10) / 10);
                completionRate.push(Math.round(Math.max(85, Math.min(100, baseCompletion)) * 10) / 10);
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        let result = params[0].name + '<br>';
                        params.forEach(item => {
                            if (item.seriesName === '响应率') {
                                result += item.marker + item.seriesName + ': ' + item.value + '%<br>';
                            } else if (item.seriesName === '响应时间') {
                                result += item.marker + item.seriesName + ': ' + item.value + '分钟<br>';
                            } else if (item.seriesName === '完成率') {
                                result += item.marker + item.seriesName + ': ' + item.value + '%<br>';
                            }
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['响应率', '完成率', '响应时间'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: times,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        interval: 2
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: '百分比 (%)',
                        position: 'left',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { 
                            color: 'rgba(255,255,255,0.5)',
                            formatter: '{value}%'
                        },
                        splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
                        min: 70,
                        max: 100
                    },
                    {
                        type: 'value',
                        name: '时间 (分钟)',
                        position: 'right',
                        nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                        axisLabel: { 
                            color: 'rgba(255,255,255,0.5)',
                            formatter: '{value}分钟'
                        },
                        splitLine: { show: false },
                        min: 0,
                        max: 10
                    }
                ],
                series: [
                    {
                        name: '响应率',
                        type: 'line',
                        data: responseRate,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        lineStyle: { 
                            color: '#00ff88', 
                            width: 3
                        },
                        itemStyle: { color: '#00ff88' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(0,255,136,0.3)' },
                                { offset: 1, color: 'rgba(0,255,136,0.1)' }
                            ])
                        }
                    },
                    {
                        name: '完成率',
                        type: 'line',
                        data: completionRate,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        lineStyle: { 
                            color: '#5470c6', 
                            width: 3
                        },
                        itemStyle: { color: '#5470c6' }
                    },
                    {
                        name: '响应时间',
                        type: 'line',
                        yAxisIndex: 1,
                        data: responseTime,
                        smooth: true,
                        symbol: 'diamond',
                        symbolSize: 8,
                        lineStyle: { 
                            color: '#ff9500', 
                            width: 2,
                            type: 'dashed'
                        },
                        itemStyle: { color: '#ff9500' }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Profit Trend Chart
        function initializeProfitTrendChart(range = '24h') {
            const chart = echarts.init(document.getElementById('profitTrendChart'));
            
            const dates = [];
            const actualProfit = [];
            const forecastProfit = [];
            
            // Generate data based on time range
            let dataPoints;
            switch(range) {
                case '24h':
                    dataPoints = 24;
                    for (let i = 0; i < dataPoints; i++) {
                        dates.push(`${i}:00`);
                        actualProfit.push(50 + Math.random() * 30);
                        forecastProfit.push(null);
                    }
                    // Add forecast
                    for (let i = 0; i < 6; i++) {
                        dates.push(`${dataPoints + i}:00`);
                        actualProfit.push(null);
                        forecastProfit.push(60 + Math.random() * 25);
                    }
                    break;
                case '7d':
                    dataPoints = 7;
                    for (let i = 0; i < dataPoints; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() - (6 - i));
                        dates.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                        actualProfit.push(55 + Math.random() * 35);
                        forecastProfit.push(null);
                    }
                    break;
                case '30d':
                default:
                    dataPoints = 30;
                    for (let i = 0; i < dataPoints; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() - (29 - i));
                        dates.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                        actualProfit.push(45 + Math.random() * 40);
                        forecastProfit.push(null);
                    }
                    break;
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        let result = params[0].name + '<br>';
                        params.forEach(item => {
                            if (item.value !== null) {
                                result += item.marker + item.seriesName + ': $' + item.value.toFixed(1) + 'K<br>';
                            }
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['实际收益', '预测收益'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '收益 ($K)',
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [
                    {
                        name: '实际收益',
                        type: 'line',
                        data: actualProfit,
                        smooth: true,
                        lineStyle: { color: '#00b96b', width: 3 },
                        itemStyle: { color: '#00b96b' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(0,185,107,0.3)' },
                                { offset: 1, color: 'rgba(0,185,107,0.05)' }
                            ])
                        }
                    },
                    {
                        name: '预测收益',
                        type: 'line',
                        data: forecastProfit,
                        smooth: true,
                        lineStyle: { color: '#1e7fff', width: 2, type: 'dashed' },
                        itemStyle: { color: '#1e7fff' }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Hourly Revenue Chart
        function initializeHourlyRevenueChart(range = '24h') {
            const chart = echarts.init(document.getElementById('hourlyRevenueChart'));
            
            const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
            const revenueData = [
                2.1, 1.8, 1.5, 1.2, 1.8, 2.5, 4.2, 6.8, 5.5, 4.3, 3.8, 3.2,
                3.5, 3.8, 4.5, 6.2, 8.5, 9.2, 7.8, 6.5, 5.2, 4.1, 3.2, 2.5
            ];
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: '{b0}<br>收益: ${c0}K'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: hours,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                yAxis: {
                    type: 'value',
                    name: '小时收益 ($K)',
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [{
                    type: 'bar',
                    data: revenueData,
                    itemStyle: {
                        color: function(params) {
                            const value = params.value;
                            if (value > 7) return '#ff3b30';
                            if (value > 5) return '#ff9500';
                            if (value > 3) return '#00b96b';
                            return '#1e7fff';
                        }
                    }
                }]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Battery Health Chart
        function initializeBatteryHealthChart(range = '24h') {
            const chart = echarts.init(document.getElementById('batteryHealthChart'));
            
            const option = {
                tooltip: {
                    formatter: '{a} <br/>{b} : {c}%'
                },
                series: [
                    {
                        name: '电池健康度',
                        type: 'gauge',
                        radius: '80%',
                        center: ['25%', '50%'],
                        startAngle: 180,
                        endAngle: 0,
                        min: 0,
                        max: 100,
                        progress: {
                            show: true,
                            width: 20
                        },
                        axisLine: {
                            lineStyle: {
                                width: 20,
                                color: [[0.8, '#ff3b30'], [0.9, '#ff9500'], [1, '#00b96b']]
                            }
                        },
                        pointer: {
                            itemStyle: {
                                color: 'auto'
                            }
                        },
                        axisTick: {
                            distance: -20,
                            length: 8,
                            lineStyle: {
                                color: '#fff',
                                width: 2
                            }
                        },
                        splitLine: {
                            distance: -30,
                            length: 30,
                            lineStyle: {
                                color: '#fff',
                                width: 4
                            }
                        },
                        axisLabel: {
                            color: 'rgba(255,255,255,0.7)',
                            distance: 30,
                            fontSize: 12
                        },
                        detail: {
                            valueAnimation: true,
                            formatter: '{value}%',
                            color: '#fff',
                            fontSize: 24,
                            offsetCenter: [0, '70%']
                        },
                        data: [{
                            value: 94.2,
                            name: '容量保持率'
                        }]
                    },
                    {
                        name: '能量效率',
                        type: 'gauge',
                        radius: '80%',
                        center: ['75%', '50%'],
                        startAngle: 180,
                        endAngle: 0,
                        min: 0,
                        max: 100,
                        progress: {
                            show: true,
                            width: 20
                        },
                        axisLine: {
                            lineStyle: {
                                width: 20,
                                color: [[0.7, '#ff3b30'], [0.85, '#ff9500'], [1, '#00b96b']]
                            }
                        },
                        pointer: {
                            itemStyle: {
                                color: 'auto'
                            }
                        },
                        axisTick: {
                            distance: -20,
                            length: 8,
                            lineStyle: {
                                color: '#fff',
                                width: 2
                            }
                        },
                        splitLine: {
                            distance: -30,
                            length: 30,
                            lineStyle: {
                                color: '#fff',
                                width: 4
                            }
                        },
                        axisLabel: {
                            color: 'rgba(255,255,255,0.7)',
                            distance: 30,
                            fontSize: 12
                        },
                        detail: {
                            valueAnimation: true,
                            formatter: '{value}%',
                            color: '#fff',
                            fontSize: 24,
                            offsetCenter: [0, '70%']
                        },
                        data: [{
                            value: 87.3,
                            name: '往返效率'
                        }]
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Performance Trend Chart
        function initializePerformanceTrendChart(range = '24h') {
            const chart = echarts.init(document.getElementById('performanceTrendChart'));
            
            const dates = [];
            const availability = [];
            const efficiency = [];
            const capacity = [];
            
            // Generate data
            let dataPoints;
            switch(range) {
                case '24h':
                    dataPoints = 24;
                    for (let i = 0; i < dataPoints; i++) {
                        dates.push(`${i}:00`);
                        availability.push(98 + Math.random() * 2);
                        efficiency.push(86 + Math.random() * 3);
                        capacity.push(94 - i * 0.01);
                    }
                    break;
                case '7d':
                    dataPoints = 7;
                    for (let i = 0; i < dataPoints; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() - (6 - i));
                        dates.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                        availability.push(97 + Math.random() * 3);
                        efficiency.push(85 + Math.random() * 4);
                        capacity.push(94.5 - i * 0.05);
                    }
                    break;
                case '30d':
                default:
                    dataPoints = 30;
                    for (let i = 0; i < dataPoints; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() - (29 - i));
                        dates.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                        availability.push(96 + Math.random() * 4);
                        efficiency.push(84 + Math.random() * 5);
                        capacity.push(95 - i * 0.03);
                    }
                    break;
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['系统可用率', '能量效率', '容量保持率'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '百分比 (%)',
                    min: 80,
                    max: 100,
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [
                    {
                        name: '系统可用率',
                        type: 'line',
                        data: availability,
                        smooth: true,
                        lineStyle: { color: '#00b96b', width: 3 },
                        itemStyle: { color: '#00b96b' }
                    },
                    {
                        name: '能量效率',
                        type: 'line',
                        data: efficiency,
                        smooth: true,
                        lineStyle: { color: '#1e7fff', width: 3 },
                        itemStyle: { color: '#1e7fff' }
                    },
                    {
                        name: '容量保持率',
                        type: 'line',
                        data: capacity,
                        smooth: true,
                        lineStyle: { color: '#ff9500', width: 3 },
                        itemStyle: { color: '#ff9500' }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Degradation Chart
        function initializeDegradationChart(range = '24h') {
            const chart = echarts.init(document.getElementById('degradationChart'));
            
            const months = [];
            const actualCapacity = [];
            const predictedCapacity = [];
            
            // Historical data
            for (let i = 0; i <= 12; i++) {
                months.push(`M${i}`);
                actualCapacity.push(100 - i * 0.48);
                predictedCapacity.push(null);
            }
            
            // Prediction
            for (let i = 13; i <= 60; i++) {
                months.push(`M${i}`);
                actualCapacity.push(null);
                predictedCapacity.push(100 - i * 0.5 - Math.pow(i/60, 2) * 5);
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        let result = params[0].name + '<br>';
                        params.forEach(item => {
                            if (item.value !== null) {
                                result += item.marker + item.seriesName + ': ' + item.value.toFixed(1) + '%<br>';
                            }
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['实际容量', '预测容量', '更换阈值'],
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    top: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: months,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { 
                        color: 'rgba(255,255,255,0.5)',
                        interval: 5
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '容量 (%)',
                    min: 70,
                    max: 100,
                    nameTextStyle: { color: 'rgba(255,255,255,0.5)' },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
                },
                series: [
                    {
                        name: '实际容量',
                        type: 'line',
                        data: actualCapacity,
                        smooth: true,
                        lineStyle: { color: '#00b96b', width: 3 },
                        itemStyle: { color: '#00b96b' }
                    },
                    {
                        name: '预测容量',
                        type: 'line',
                        data: predictedCapacity,
                        smooth: true,
                        lineStyle: { color: '#1e7fff', width: 2, type: 'dashed' },
                        itemStyle: { color: '#1e7fff' }
                    },
                    {
                        name: '更换阈值',
                        type: 'line',
                        markLine: {
                            data: [{ yAxis: 80 }],
                            lineStyle: { color: '#ff3b30', width: 2, type: 'dashed' },
                            label: {
                                formatter: '更换阈值: 80%',
                                color: '#ff3b30'
                            }
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // Initialize Deviation Heatmap Chart
        function initializeDeviationHeatmap(range = '24h') {
            const chart = echarts.init(document.getElementById('deviationHeatmapChart'));
            
            // 热力图数据
            const hours = [];
            const regions = ['NSW1', 'QLD1', 'SA1', 'TAS1', 'VIC1'];
            const heatmapData = [];
            
            for (let i = 0; i < 24; i++) {
                hours.push(`${i}:00`);
                for (let j = 0; j < regions.length; j++) {
                    // 生成-10%到+10%的偏差率
                    let deviation;
                    
                    // 模拟真实的偏差模式
                    if (i >= 7 && i <= 9) { // 早高峰
                        deviation = (Math.random() - 0.5) * 15;
                    } else if (i >= 17 && i <= 19) { // 晚高峰
                        deviation = (Math.random() - 0.5) * 18;
                    } else if (i >= 14 && i <= 16) { // 午后
                        deviation = (Math.random() - 0.7) * 12;
                    } else if (i >= 0 && i <= 5) { // 深夜
                        deviation = (Math.random() - 0.5) * 5;
                    } else {
                        deviation = (Math.random() - 0.5) * 10;
                    }
                    
                    heatmapData.push([i, j, deviation.toFixed(2)]);
                }
            }

            const option = {
                tooltip: {
                    position: 'top',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    borderColor: 'rgba(255,255,255,0.1)',
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        return `${hours[params.value[0]]} ${regions[params.value[1]]}<br>偏差率: ${params.value[2]}%`;
                    }
                },
                grid: {
                    height: '80%',
                    top: '10%'
                },
                xAxis: {
                    type: 'category',
                    data: hours,
                    splitArea: {
                        show: true
                    },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                yAxis: {
                    type: 'category',
                    data: regions,
                    splitArea: {
                        show: true
                    },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.5)' }
                },
                visualMap: {
                    min: -10,
                    max: 10,
                    calculable: true,
                    orient: 'horizontal',
                    left: 'center',
                    bottom: '0%',
                    textStyle: { color: '#999' },
                    inRange: {
                        color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
                    }
                },
                series: [{
                    name: '偏差率热力图',
                    type: 'heatmap',
                    data: heatmapData,
                    label: {
                        show: false
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }
    </script>
</body>
</html>